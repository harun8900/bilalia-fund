<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق صندوق البلالية الطبي | الشامل</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg-body: #050a18;
            --card-bg: #0f172a;
            --accent-blue: #00d2ff;
            --accent-green: #00e676;
            --danger: #ff5252;
            --gold: #ffd700;
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg-body); color: white; margin: 0; padding: 0; position: relative; }
        
        /* تنسيق اللوغو في الزاوية اليمنى العليا */
        .main-logo {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 80px;
            height: 80px;
            z-index: 1000;
        }
        .main-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
            border: 2px solid #ffffff;
            background: #0a1221;
        }

        .header { padding: 40px 30px; text-align: center; border-bottom: 2px solid var(--accent-blue); background: linear-gradient(180deg, #111a2e 0%, var(--bg-body) 100%); }
        .container { max-width: 1200px; margin: 0 auto; padding: 15px; }
        
        /* تحسينات التصميم من الصور المرسلة */
        .info-section { background: var(--card-bg); border-radius: 15px; padding: 25px; margin-bottom: 25px; border: 1px solid rgba(0,210,255,0.1); }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        
        input, select { background: #1a253d; border: 1px solid #334155; color: white; padding: 12px; border-radius: 8px; outline: none; }
        .btn { padding: 12px 25px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-blue { background: var(--accent-blue); color: #000; }
        
        .hidden { display: none !important; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid rgba(255,255,255,0.05); }

        @media (max-width: 600px) {
            .main-logo { width: 60px; height: 60px; position: static; margin: 0 auto 10px; display: block; }
        }
    </style>
</head>
<body>

<div class="main-logo">
    <img src="Loogo.png" alt="Logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3063/3063176.png'">
</div>

<div class="header">
    <h1>صندوق البلالية الطبي</h1>
    <div style="color: var(--accent-blue); font-size: 14px;">برمجة وتنفيذ: محمد هارون</div>
</div>

<div class="container">
    <div class="info-section">
        <h3 style="color: var(--accent-blue);"><i class="fas fa-info-circle"></i> نبذة عن المشروع وأهدافه</h3>
        <p style="font-size: 14px; line-height: 1.6;">قال تعالى: (وتعاونوا على البر والتقوى ولا تعاونوا على الإثم والعدوان). نظراً لضيق المعيشة، تم تفعيل هذا الصندوق لمساعدة أهلنا في الحالات الطارئة.</p>
        <ul style="font-size: 13px; color: #94a3b8;">
            <li>الدفع دوري شهري (أول 10 أيام من الشهر).</li>
            <li>الحد الأدنى للدفع 25 ألف ليرة سورية.</li>
            <li style="color: var(--danger);">لا يمكن صرف الروشتات الدوائية.</li>
        </ul>
    </div>

    <div class="dashboard">
        <div class="stat-card">إجمالي الليرة السورية <span id="total-syp" style="display:block; font-size:22px; color:var(--accent-green); margin-top:10px;">0</span></div>
        <div class="stat-card">إجمالي الدولار <span id="total-usd" style="display:block; font-size:22px; color:var(--gold); margin-top:10px;">0</span></div>
    </div>

    <div class="info-section" style="border: 1px dashed var(--accent-blue);">
        <h4>لوحة الإدارة الآمنة</h4>
        <div id="admin-lock">
            <input type="password" id="pass-input" placeholder="أدخل كلمة السر">
            <button class="btn btn-blue" onclick="unlockAdmin()">تفعيل الصلاحيات</button>
        </div>
        
        <div id="admin-controls" class="hidden">
            <div style="display: grid; gap: 10px; margin-top: 20px;">
                <input type="text" id="month-name" placeholder="اسم الشهر الجديد">
                <button class="btn btn-blue" style="background: var(--gold);" onclick="addMonth()">إضافة شهر جديد</button>
                <hr style="border: 0.1px solid #334155; width: 100%;">
                <select id="select-month"></select>
                <input type="text" id="member-name" placeholder="اسم المشترك">
                <input type="number" id="amount" placeholder="المبلغ">
                <select id="currency">
                    <option value="SYP">ليرة سورية</option>
                    <option value="USD">دولار</option>
                </select>
                <button class="btn btn-blue" onclick="saveData()">حفظ البيانات</button>
            </div>
        </div>
    </div>

    <div id="display-area"></div>
</div>

<script>
    // إعدادات الاتصال (تأكد من أن هذه البيانات مطابقة لمشروعك في Supabase)
    const SUPABASE_URL = "https://xuiwkvkrhatcoovfozsq.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh1aXdrdmtyaGF0Y29vdmFvenNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4NzA0NzYsImV4cCI6MjA4NTQ0NjQ3Nn0.Bp0ZyYi8O95jZhtALxxJwK6MQWau1WGGaBoUes5f3os";
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function unlockAdmin() {
        if(document.getElementById('pass-input').value === 'هارون567') {
            document.getElementById('admin-lock').classList.add('hidden');
            document.getElementById('admin-controls').classList.remove('hidden');
            loadData();
        } else { alert('كلمة السر غير صحيحة'); }
    }

    async function addMonth() {
        const name = document.getElementById('month-name').value;
        if(!name) return;
        const { error } = await _supabase.from('months').insert([{ name: name }]);
        if(!error) { document.getElementById('month-name').value = ''; loadData(); }
    }

    async function saveData() {
        const mId = document.getElementById('select-month').value;
        const name = document.getElementById('member-name').value;
        const amt = document.getElementById('amount').value;
        const cur = document.getElementById('currency').value;

        if(!mId || !name || !amt) return alert('يرجى إكمال البيانات');

        const { error } = await _supabase.from('data').insert([{ month_id: mId, name: name, amt: amt, cur: cur, type: 'توفير' }]);
        if(!error) {
            document.getElementById('member-name').value = '';
            document.getElementById('amount').value = '';
            loadData();
        }
    }

    async function loadData() {
        const { data: months } = await _supabase.from('months').select('*').order('id', { ascending: false });
        const { data: allItems } = await _supabase.from('data').select('*');

        const area = document.getElementById('display-area');
        const select = document.getElementById('select-month');
        area.innerHTML = ''; select.innerHTML = '';

        let totalSYP = 0; let totalUSD = 0;

        months.forEach(m => {
            select.innerHTML += `<option value="${m.id}">${m.name}</option>`;
            let rows = '';
            const filtered = allItems.filter(i => i.month_id == m.id);
            
            filtered.forEach(i => {
                rows += `<tr><td>${i.name}</td><td>${i.amt}</td><td>${i.cur}</td></tr>`;
                if(i.cur === 'SYP') totalSYP += parseFloat(i.amt);
                else totalUSD += parseFloat(i.amt);
            });

            area.innerHTML += `
                <div class="info-section">
                    <h4 style="color:var(--accent-blue)">جدول شهر: ${m.name}</h4>
                    <table>
                        <thead><tr><th>الاسم</th><th>المبلغ</th><th>العملة</th></tr></thead>
                        <tbody>${rows || '<tr><td colspan="3">لا يوجد بيانات</td></tr>'}</tbody>
                    </table>
                </div>
            `;
        });

        document.getElementById('total-syp').innerText = totalSYP.toLocaleString() + ' ل.س';
        document.getElementById('total-usd').innerText = '$' + totalUSD.toLocaleString();
    }

    loadData();
</script>
</body>
</html>
