<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ù„Ø§Ù„ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠ | Ø¨Ø¥Ø´Ø±Ø§Ù Ù…Ø­Ù…Ø¯ Ù‡Ø§Ø±ÙˆÙ†</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #00d2ff; --secondary: #0081a7; --bg: #050a18; --card-bg: #0f172a; --accent: #4ade80; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: #f8fafc; margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: auto; }
        
        /* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, #0f172a, #1e293b); padding: 15px; border-radius: 12px; border-left: 4px solid var(--primary); text-align: center; }
        .stat-card h5 { margin: 0; font-size: 12px; opacity: 0.8; }
        .stat-card p { margin: 5px 0 0; font-size: 18px; font-weight: bold; color: var(--primary); }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .section { background: var(--card-bg); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #1e293b; }
        .section-title { color: var(--primary); border-bottom: 1px solid #334155; padding-bottom: 10px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        
        /* Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† ÙˆØ§Ù„Ù‚Ø§Ø¦Ù…ÙˆÙ† */
        .info-list { font-size: 13px; line-height: 1.6; text-align: right; padding-right: 20px; }
        .admin-list { list-style: none; padding: 0; font-size: 14px; }
        .admin-list li { padding: 8px; border-bottom: 1px solid #1e293b; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        input, select { padding: 12px; width: 100%; border-radius: 8px; border: 1px solid #334155; background: #1e293b; color: white; margin-bottom: 10px; box-sizing: border-box; }
        .btn { padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-lock { background: #334155; color: white; margin-top: 10px; }
        .admin-content { display: none; margin-top: 15px; border-top: 2px dashed var(--primary); padding-top: 15px; }

        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† */
        table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; }
        th { background: #1e293b; color: var(--primary); padding: 10px; text-align: right; }
        td { padding: 10px; border-bottom: 1px solid #1e293b; }
        .type-in { color: var(--accent); }
        .type-out { color: #fb7185; }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align: center; padding: 20px 0;">
        <h2 style="margin: 0;">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ù„Ø§Ù„ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠ</h2>
        <p style="font-size: 12px; opacity: 0.7;">Ø¨Ø±Ù…Ø¬Ø© ÙˆØªÙ†ÙÙŠØ°: Ù…Ø­Ù…Ø¯ Ù‡Ø§Ø±ÙˆÙ†</p>
    </header>

    <div class="stats-grid">
        <div class="stat-card">
            <h5>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</h5>
            <p id="totalUsers">0</p>
        </div>
        <div class="stat-card">
            <h5>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ</h5>
            <p id="totalBalance">0 $</p>
        </div>
    </div>

    <div class="section">
        <div class="section-title">ğŸ›¡ï¸ Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ£Ù‡Ø¯Ø§ÙÙ‡</div>
        <div class="info-list">
            <p>Ù‚Ø§Ù„ ØªØ¹Ø§Ù„Ù‰: (ÙˆØªØ¹Ø§ÙˆÙ†ÙˆØ§ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø± ÙˆØ§Ù„ØªÙ‚ÙˆÙ‰). Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø£Ù‡Ù„Ù†Ø§ ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©.</p>
            <b>Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚:</b>
            <ul>
                <li>ØªØºØ·ÙŠØ© Ø­Ø§Ù„Ø§Øª: ÙˆÙØ§Ø© - Ø¹Ù…Ù„ÙŠØ§Øª - Ø­ÙˆØ§Ø¯Ø« Ø·Ø§Ø±Ø¦Ø©.</li>
                <li>Ø§Ù„Ø¯ÙØ¹ Ø´Ù‡Ø±ÙŠØŒ Ø¨Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 25 Ø£Ù„Ù Ù„.Ø³.</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <div class="section-title">ğŸ‘¥ Ø§Ù„Ù‚Ø§Ø¦Ù…ÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
        <ul class="admin-list">
            <li>Ù‚Ø§Ø³Ù… Ø·Ø§Ù„Ø¨ | Ø±Ø§Ù…ÙŠ Ø¨Ø§ÙƒÙŠØ± | Ø­Ø³Ù† Ø§Ù„Ø®Ø·ÙŠØ¨</li>
            <li>Ù‡ÙŠØ§Ù… Ø´Ø­Ø§Ø¯Ø© | Ù†ÙˆØ±Ø³ Ø¹Ø¨Ø¯ Ø§Ù„Ø³Ù„Ø§Ù… | Ù…Ø­Ù…Ø¯ Ù‚ÙˆÙŠØ¯Ø±</li>
        </ul>
    </div>

    <div class="section" id="adminSection">
        <div class="section-title">ğŸ” Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¢Ù…Ù†Ø©</div>
        <input type="password" id="adminPass" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª">
        <button class="btn btn-primary" onclick="unlockAdmin()">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button>
        
        <div id="adminControls" class="admin-content">
            <h5>Ø£Ù‡Ù„Ø§Ù‹ Ù…Ø­Ù…Ø¯ Ù‡Ø§Ø±ÙˆÙ† - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù…ÙØ¹Ù„Ø©</h5>
            <input type="text" id="newMonth" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯">
            <button class="btn btn-primary" style="margin-bottom: 20px;" onclick="addMonth()">Ø¥Ø¶Ø§ÙØ© Ø´Ù‡Ø±</button>
            
            <hr>
            
            <select id="monthSelect"></select>
            <input type="text" id="userName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø£Ùˆ Ø§Ù„Ø¨ÙŠØ§Ù†">
            <input type="number" id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
            <select id="type">
                <option value="ØªÙˆÙÙŠØ±">ØªÙˆÙÙŠØ± (+)</option>
                <option value="Ù…ØµØ±ÙˆÙ">Ù…ØµØ±ÙˆÙ (-)</option>
            </select>
            <button class="btn btn-primary" onclick="addData()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="btn btn-lock" onclick="location.reload()">Ù‚ÙÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button>
        </div>
    </div>

    <div class="section">
        <div class="section-title">ğŸ“… Ø³Ø¬Ù„ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
        <select id="viewFilter" onchange="loadTableData()"></select>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ø´ØªØ±Ùƒ/Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                </tr>
            </thead>
            <tbody id="dataTableBody"></tbody>
        </table>
    </div>
</div>

<script>
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ø¬Ø­Ø©
    const URL = "https://xuiwkvkrhatcoovfozsq.supabase.co";
    const KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh1aXdrdmtyaGF0Y29vdmZvenNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4NzA0NzYsImV4cCI6MjA4NTQ0NjQ3Nn0.Bp0ZyYi8O95jZhtALxxJwK6MQWau1WGGaBoUes5f3os";
    const _db = supabase.createClient(URL, KEY);

    // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    const ADMIN_KEY = "123";

    function unlockAdmin() {
        if(document.getElementById('adminPass').value === ADMIN_KEY) {
            document.getElementById('adminControls').style.display = 'block';
            document.getElementById('adminPass').style.display = 'none';
            alert("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø­Ù…Ø¯ Ù‡Ø§Ø±ÙˆÙ†ØŒ ØªÙ… ÙØªØ­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª");
        } else { alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©"); }
    }

    async function loadInitial() {
        const { data: months } = await _db.from('months').select('*').order('id', {ascending: false});
        let options = "";
        months.forEach(m => options += `<option value="${m.id}">${m.name}</option>`);
        document.getElementById('monthSelect').innerHTML = options;
        document.getElementById('viewFilter').innerHTML = options;
        loadTableData();
        updateStats();
    }

    async function addMonth() {
        const name = document.getElementById('newMonth').value;
        await _db.from('months').insert([{ name }]);
        location.reload();
    }

    async function addData() {
        const mid = document.getElementById('monthSelect').value;
        const name = document.getElementById('userName').value;
        const amt = document.getElementById('amount').value;
        const type = document.getElementById('type').value;
        
        const { error } = await _db.from('data').insert([{ month_id: mid, name, amt, type }]);
        if(!error) { alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­"); loadTableData(); updateStats(); }
    }

    async function loadTableData() {
        const mid = document.getElementById('viewFilter').value;
        const { data } = await _db.from('data').select('*').eq('month_id', mid);
        let rows = "";
        data.forEach(d => {
            rows += `<tr>
                <td>${d.name}</td>
                <td>${d.amt}</td>
                <td class="${d.type === 'ØªÙˆÙÙŠØ±' ? 'type-in' : 'type-out'}">${d.type}</td>
            </tr>`;
        });
        document.getElementById('dataTableBody').innerHTML = rows;
    }

    async function updateStats() {
        const { data } = await _db.from('data').select('amt, type');
        let total = 0;
        let users = new Set();
        data.forEach(d => {
            if(d.type === 'ØªÙˆÙÙŠØ±') {
                total += parseFloat(d.amt);
                users.add(d.name);
            } else {
                total -= parseFloat(d.amt);
            }
        });
        document.getElementById('totalBalance').innerText = total + " $";
        document.getElementById('totalUsers').innerText = users.size;
    }

    loadInitial();
</script>
</body>
    </html>
    
