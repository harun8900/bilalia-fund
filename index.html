<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صندوق البلالية الطبي | Cloud</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #050a18; --card: #0f172a; --blue: #00d2ff; --green: #00e676; --red: #ff5252; --gold: #ffd700; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 0; }
        .header { padding: 30px; text-align: center; border-bottom: 2px solid var(--blue); background: #111a2e; }
        .container { max-width: 900px; margin: 0 auto; padding: 15px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 10px; }
        .stat-card span { display: block; font-size: 20px; font-weight: bold; margin-top: 5px; }
        .admin-box { background: rgba(0,210,255,0.05); padding: 20px; border-radius: 15px; border: 1px dashed var(--blue); margin-bottom: 25px; }
        input, select { background: #1a253d; border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; margin: 5px; width: calc(100% - 30px); }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; width: 100%; margin-top: 5px; }
        .btn-blue { background: var(--blue); color: #000; }
        .btn-red { background: var(--red); color: white; }
        .month-block { background: var(--card); border-radius: 15px; margin-bottom: 25px; border: 1px solid rgba(0,210,255,0.1); overflow: hidden; }
        .m-header { background: #152036; padding: 15px; display: flex; justify-content: space-between; align-items: center; color: var(--gold); }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .hidden { display: none !important; }
        footer { text-align: center; padding: 40px; color: #475569; font-size: 11px; }
    </style>
</head>
<body>

<div class="header">
    <h1>صندوق البلالية الطبي</h1>
    <div style="color:var(--blue); font-weight:bold;">برمجة وتنفيذ: محمد هارون</div>
</div>

<div class="container">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
        <div class="stat-card">الصافي (ليرة) <span id="total-syp" style="color:var(--green)">0</span></div>
        <div class="stat-card">الصافي (دولار) <span id="total-usd" style="color:var(--gold)">0</span></div>
    </div>

    <div class="admin-box">
        <div id="lock-ui" style="text-align:center">
            <input type="password" id="pass" placeholder="كلمة السر للإدارة">
            <button class="btn btn-blue" onclick="checkPass()">تفعيل التحرير</button>
        </div>
        <div id="admin-ui" class="hidden">
            <input type="text" id="new-m" placeholder="أضف شهر جديد (مثال: يناير 2026)">
            <button class="btn btn-blue" onclick="addMonth()">إضافة الشهر</button>
            <hr style="border:0; border-top:1px solid #334155; margin:15px 0;">
            <select id="m-select"></select>
            <input type="text" id="i-name" placeholder="الاسم أو بيان الصرف">
            <input type="number" id="i-amt" placeholder="المبلغ">
            <select id="i-cur"><option value="SYP">ليرة سورية</option><option value="USD">دولار أمريكي</option></select>
            <button class="btn btn-blue" onclick="saveItem('member')">إضافة مشترك</button>
            <button class="btn btn-red" onclick="saveItem('expense')">إضافة مصروف</button>
        </div>
    </div>

    <div id="display-area">جارٍ تحميل البيانات...</div>
</div>

<footer> Muhammed Harun 2026® </footer>

<script>
    // الإعدادات الخاصة بك
    const S_URL = "https://xuiwkvrhatcoovfozsq.supabase.co";
    const S_KEY = "sb_publishable_T2ltCUtwwPR4b_Oh_dOPFQ_qfcCmFfM";
    const _db = supabase.createClient(S_URL, S_KEY);

    let isAdmin = false;

    function checkPass() {
        if(document.getElementById('pass').value === 'هارون456') {
            isAdmin = true;
            document.getElementById('lock-ui').classList.add('hidden');
            document.getElementById('admin-ui').classList.remove('hidden');
            loadData();
        } else { alert('كلمة السر خطأ'); }
    }

    async function addMonth() {
        const name = document.getElementById('new-m').value;
        if(!name) return;
        await _db.from('months').insert([{ name }]);
        document.getElementById('new-m').value = '';
        loadData();
    }

    async function saveItem(type) {
        const mId = document.getElementById('m-select').value;
        const name = document.getElementById('i-name').value;
        const amt = parseFloat(document.getElementById('i-amt').value);
        const cur = document.getElementById('i-cur').value;
        if(!mId || !name || !amt) return;
        await _db.from('data').insert([{ month_id: mId, name, amt, cur, type }]);
        document.getElementById('i-name').value = '';
        document.getElementById('i-amt').value = '';
        loadData();
    }

    async function deleteItem(id, table) {
        if(confirm('هل تريد الحذف؟')) {
            await _db.from(table).delete().eq('id', id);
            loadData();
        }
    }

    async function loadData() {
        const { data: months } = await _db.from('months').select('*').order('created_at', { ascending: false });
        const { data: info } = await _db.from('data').select('*');
        
        const area = document.getElementById('display-area');
        const sel = document.getElementById('m-select');
        area.innerHTML = ''; sel.innerHTML = '';

        let totalSyp = 0, totalUsd = 0;

        months.forEach(m => {
            sel.innerHTML += `<option value="${m.id}">${m.name}</option>`;
            const items = info.filter(d => d.month_id === m.id);
            let rows = '';

            items.forEach(i => {
                const isExp = i.type === 'expense';
                rows += `<tr style="${isExp?'color:#ff9999':''}">
                    <td>${isExp?'[مصرف] ':''}${i.name}</td>
                    <td>${i.amt.toLocaleString()}</td>
                    <td>${i.cur}</td>
                    <td class="${isAdmin?'':'hidden'}"><button onclick="deleteItem(${i.id},'data')" style="background:none; border:none; color:red; cursor:pointer">❌</button></td>
                </tr>`;
                
                let val = isExp ? -i.amt : i.amt;
                if(i.cur === 'SYP') totalSyp += val; else totalUsd += val;
            });

            area.innerHTML += `
                <div class="month-block">
                    <div class="m-header">
                        <strong>${m.name}</strong>
                        <button class="${isAdmin?'':'hidden'}" onclick="deleteItem(${m.id},'months')" style="background:none; border:none; color:white; font-size:10px;">حذف الشهر</button>
                    </div>
                    <table>
                        <thead><tr><th>البيان</th><th>المبلغ</th><th>العملة</th><th class="${isAdmin?'':'hidden'}"></th></tr></thead>
                        <tbody>${rows || '<tr><td colspan="4" style="text-align:center">لا يوجد بيانات</td></tr>'}</tbody>
                    </table>
                </div>`;
        });

        document.getElementById('total-syp').innerText = totalSyp.toLocaleString();
        document.getElementById('total-usd').innerText = totalUsd.toLocaleString();
    }

    loadData();
</script>
</body>
</html>
